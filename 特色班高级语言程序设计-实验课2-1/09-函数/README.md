# 函数
## 函数的概念

函数是一组一起执行一个任务的语句。每个 C++ 程序都至少有一个函数，即主函数 _`main()`_ ，所有简单的程序都可以定义其他额外的函数。

您可以把代码划分到不同的函数中。如何划分代码到不同的函数中是由您来决定的，但在逻辑上，划分通常是根据每个函数执行一个特定的任务来进行的。

函数**声明**告诉编译器函数的名称、返回类型和参数。函数**定义**提供了函数的实际主体。

C++ 标准库提供了大量的程序可以调用的内置函数。例如，函数 _`strcat()`_ 用来连接两个字符串，函数 _`memcpy()`_ 用来复制内存到另一个位置。
***
## 函数的使用
#### 函数的声明

C++程序允许两种函数说明语句的形式，分别称为函数原型（或函数声明） 和函数定义

函数原型（亦称函数声明）用来指出函数的名称、类型和参数，其格式为：

```cpp
[<属性说明>]<类型><函数名>(<参数表>);
```

C++程序允许两种函数说明语句的形式，分别称为函数原型（或函数声明） 和函数定义
***
###### 函数原型
函数原型（亦称函数声明）用来指出函数的名称、类型和参数，其格式为：
```cpp
[<属性说明>]<类型><函数名>(<参数表>); 
```
- **属性说明**
	可缺省，一般可以是下面的关键字之一：_`inline`_(内联)、_`static`_(静态)、 _`virtual`_(虚函数)、_`friend`_(友元) 等
- **类型**
	指函数的返回类型。C ++语言规定除了特别情形（类的构造函数、 析构函数）之外，所有函数都必须在说明中指出返回类型。一个函数可能有多个结果，不一定都用返回值的方式输出（还可通过全局变量、引用参数和指针等方式传出）计算结果，但函数调用作为一个表达式，表达式的值则只能是函数的返回值
- **函数名**
	一个标识符
- **参数表**
	可能为空、为 _`void`_ 或（_`<类型><参数名>，<类型><参数名>…`_） 的形式。

函数原型一般在两种情形下被使用

- 在程序中某函数的调用语句出现在该函数的定义之前，必须在调用语句之前列出函数原型。

> 	注意C++程序所有的函数和变量定义申明都是从上往下的，如果在调用函数之前没有定义该函数名，即使是在其下一行才定义该函数名，那么都是不合法的

- 为了定义的类简明清晰，一般把较大的函数成员定义移到类说明之外，这时应把该 函数的原型列于类说明之中。
***
###### 函数定义

函数定义与函数原型的主要区别是它还包括函数体，其格式为： 
```cpp
[<属性说明>]<类型><函数名>(<参数表>)<函数体>
```
属性说明、类型、函数名与函数原型一致，参数表中 **不可省略** 参数名

- **函数体**
	由 `{` 和 `}` 括起来的复合语句，即程序块

函数定义本身是一种说明语句，函数体则是一个复合语句。而在函数体内 部又可能包含说明语句、表达式语句、控制语句和复合语句。
***
#### 函数调用

函数调用是对已定义函数的一次实际运行，与某类型的一个变量和某类 （后文介绍）的一个对象类似，函数调用可以看作是函数定义的一个“实例”

函数说明中的参数称为形式参数（形参），函数调用中的参数称为实际参 数（实参），函数调用一般出现在表达式中或独立形成一个函数调用语句

函数调用的两要素是函数名和实参表： 

```cpp
<函数名> (<实参表>) 
```

实参表中的参数的类型、个数、顺序必须与函数说明的参数表（形参表）相 一致。赋值型的实参可以是一个表达式，例如

```cpp
xr=cuberoot(–q/2+a)+cuberoot(–q/2–a); 
swap (a, b);
```

***
函数 _`cuberoot(x)`_ 调用，其具体的调用实施过程如下：

1. 根据调用语句中的函数名（_`cuberoot`_）在整个程序中搜索同名函数定义。（可能有同名函数重载的）

2. 对实参的个数、类型、顺序进行核对，判定是否与函数定义中的形参表 对应一致，在上例中只有一个浮点型参数。（从同名函数中区分）

3. 根据参数的类型（值参数或引用参数）进行值参数的值传递或引用参数 的“换名”，在上例中即是要把实参表达式的值计算出来赋给形参 _`x`_

4. 运行函数体代码

5. 返回调用点，并返回所要求的函数值，即返回计算结果 _`croot`_ 的值
***
## 函数间的数据传递
#### 变量与函数作用域

程序中出现的所有名字（标识符）都 **必须说明**，每个名字（变量名、常量 名、参数名、函数名、类名、对象名等）都在程序的一定范围内有意义， 就是该名字的作用域

函数与变量一样，都具有不同的作用域（函数没有生存期），不允许调用不在变量或者函数作用域的变量和函数

每个函数都具有独立的作用域，即函数内部定义的变量（局部变量）对函 数外部不可见，也对其他函数不可见

这意味着在一个函数内部定义的变量只能在该函数内部访问和使用，而在 其他函数或全局作用域内部是不可见的。（即使是调用函数的局部变量也 对被调用的函数不可见）

除了全局变量之外，其他变量对函数而言不可见
***
#### 函数间的数据传递方式

函数是程序的基本模块，这种划分是十分必要的，一个程序中的各个函数 又是互相联系的，这种联系体现为函数间的数据传递

 C++语言为函数间的数据传递提供了多种机制：
 
 1. 通过赋值参数和返回语句
	 从调用它的函数接收数据，通过返回（_`return`_）语句向 调用它的函数传回数据，两者都是 **单方向** 的
	 
 2. 通过全局变量
	 全局变量的定义域可延续到整个程序执行结束，因此，只要在函数中没有把该全局变量名说明为其他变量，在所有的函数中就可以直接访问它，也就是说，函数间的数据传递还可以通过全局变量实现，这种传递可以是双向的
	 
3. 通过指针类型参数和引用参数
	通过指针类型的赋值参数给函数传进的不是数据本身，而是数据的地址，在函数体运行时，可以从该地址获得数据或输出数据，其作用类似于全局变量，数据的传递可以是双向的
	

4. 通过函数的数组类型参数
	C++语言规定对于数组参数在调用时只传递该数组的首地址，实际上，就是该数组的指针，其效果与指针类型参数相同，这种数据的传递也是双向的
***
#### 函数的返回与返回传递

函数的返回完成两项任务：

- 把运行控制从函数体返回到函数调用点

- 根据返回值要求，返回所需要的数据值
***
函数的返回类型

- 返回 _`void`_ 类型
	如果函数无返回值，应说明为 _`void`_ 类型。这样的函数不需返回任何数据，一般仅形成一个函数调用语句
- 返回数值类型
	最常见的函数是返回一个数值的函数。这类函数的调用表达式可以出现在表达式语句中。当函数要返回的数值不止一个时，一般它可以以结构或类的形式，也可以以结构、数组或对象指针类型方式实现
- 返回引用类型
	值返回方式是 C 和 Pascal 语言中唯一的返回方式，C++语言提供的引用返回概念是其特有的一种很强的功能，当定义函数把该函数说明为某类型的 引用类型时，该函数调用后返回的不单是值，而是包含返回值的变量（或对象）
***
#### 参数与参数传递

C++语言在进行函数调用时，对参数的处理有两种方式： 

- 赋值型
	赋值型是普通的形式，在 C 语言中只有这种方式，所有的参数都是局部变量赋值，不会改变外部的值

- 引用型
	函数定义的参数表中，名字前加上符号 `＆` 的参数为引用形参。对引用型的参数进行修改会直接影响到原参数

***

###### 赋值调用方式的步骤

1. 检查函数名及参数表之后

2. 为值参数分配内存

3. 然后计算各对应的实参表达式

4. 把计算的值赋给刚刚创建的参数变量

5. 开始函数体的运行

***

###### 赋值形参和引用形参

在函数定义的参数中，除了被声明为引用 `&` 的参数之外，其余所有类型的形参都属于赋值形参

凡是赋值形参，在每次调用函数时，都自动为每一个赋值形参创建一个新的参数变量

为赋值形参创建的参数变量是局限于函数体运行的局部变量，它作为该形参的一个 实例，参加函数体程序块的本次运行，一旦运行完毕，这个参数变量就被释放

函数定义的参数表中，名字前加上符号 `＆` 的参数称为引用形参
***
引用形参在调用过程中的参数传递机制不同于赋值形参。其要点如下：

- 函数的调用语句中对应于引用形参的实参必须是同一类型的变量，非变量的表达式则不允许

- 参数传递的内容不是实参的值，而是地址，其实际的效果是令对应的引用形参在调 用过程中，作为一个变量名指向作为实参的这个变量，与赋值形参的不同在这里体 现出来，在引用调用过程中并不创建新的参数变量

- 在函数体程序块的运行中，引用形参每次出现后，由于它已经指向实参变量，因此 相当于全用实参变量所代替。即起到了所谓的“换名”的作用

- 在函数体程序运行结束，控制转回调用点时，该引用形参与实参变量的对应关系也就终止了。但是在调用过程中对于这个实参变量的所有处理和操作的结果，却保留 了下来，这一点也是区别于赋值调用的。
***
设计函数在下面两种情形时，采取引用调用方式： 

- 需要改变某些变量的值

- 对于占内存较多的数据参数，为了不另建新的参数变量以节省内存，建议采用引用参数。为了保证实参不在函数中被修改，可在形参声明中加上 _`const`_ 说明
***
## 函数嵌套

一个函数的函数体中包含一个或多个函数调用语句，即称为函数嵌套。 

嵌套的含义是，如果函数 A 要调用函数 B，也就是说，函数 A 的定义要依赖于函数 B 的定义。因此函数 B的定义或函数 B 的原型必须出现在函数 A 的定义语句之前

函数 A 调用函数 B，在调用 A 的过程中，即执行 A 的函数体过程中调用 B， 也就是中途把程序控制点转到 B 的函数体，在执行结束后再返回到 A 的函数体中

函数嵌套调用所占用的空间（如赋值参数的创建等）用栈（stack）的方式 管理。一般这种栈所分配的空间是有限的，因此函数互相嵌套的层数也是有限的。
## 内联函数

通过关键字 _`inline`_ 将函数声明为内敛

在编译过程中，凡内联函数，系统把它的执行代码插入到该函数的每个调用点，从而使程序执行过程中，每次调用该函数时不需转移控制点，但该函数代码可能有多个拷贝出现在目标程序中。也就是说，把多次调用的函数说明为内联函数，会使目标程序占用的空间加大，而运行时间得到节省。

为了优化程序、提高程序的运行效率，一般把函数体短小而又频繁调用的函数声明为内联函数

利用编译预处理的宏定义方式，也可以实现类似于内联函数的功能。不过， 内联函数的方式更为方便、可靠。一个发生在编译前，一个发生在编译中

**值得注意的是，如果已定义的函数多于一行，编译器会忽略 _`inline`_ 限定符**
